<%-include('../includes/admin/head.ejs')%>
<link rel="stylesheet" href="/css/categoryList.css">
<link rel="stylesheet" href="//cdn.datatables.net/1.13.1/css/jquery.dataTables.min.css">

<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous"></head>
<script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" />
<title>Document</title>
  </head>
  <%-include('../includes/admin/navigation.ejs')%>
        <div class="col py-3 user-details" style="background-color: #cfe2b9;">
        
            <h2 class="d-flex justify-content-center mt-5">Sales Report</h2>

            <form action="/admin_panel/download" method="post">
            <div class="row container mt-4">
              <div class="col-12 col-lg-4">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">From</h5>
              </div>
              <div class="card-body">
                <input type="date" name="from" class="form-control" placeholder="From">
              </div>
            </div>
              </div>
              
              <div class="col-12 col-lg-4">
            <div class="card">
              <div class="card-header">
                <h5 class="card-title mb-0">To</h5>
              </div>
              <div class="card-body">
                <input type="date" name="to" class="form-control" placeholder="To">
              </div>
            </div>from
              </div>
            
              <div class="col-12 col-lg-2 ">
            <div class="card">
              <div class="card-body d-flex justify-content-center">
                <button type="submit" class="btn btn-success" >Download</button>
              </div>
            </div>
              </div>
            </div>
            </form>
            
                        <main class="content mt-0">
                            <div class="container-fluid p-0">
                                <table id="month-table">
                                <table class="table table-dark table-striped display" id="table_id">
                                    <thead>
                                        <tr>
                                            <th scope="col">Customer Name</th>
                                            <th scope="col">Payment Status</th>
                                            <th scope="col">Order Status</th>
                                            <th scope="col">Total Amount</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <%sales.forEach(data=>{%>
                                          <tr>
                                            <td><%=data.name%></td>
                                            <td><%=data.paymentStatus%></td>
                                            <td><%=data.orderStatus%></td>
                                            <td><%=data.totalAmount%></td>
                                        </tr>
                                        <%})%>
                                           
                                            
                                        </tbody>
                                    </table>
                                    </table>
                                </div>
                        </main>
                    </div>
                </div>
            </div>
        
  </body>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
<script src="/js/adminAjaxCall.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
  $(document).ready( function () {
  $('#table_id').DataTable();
} );
</script>

<script
  type="text/javascript"
  src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"
></script>
<script
  type="text/javascript"
  src="https://html2canvas.hertzen.com/dist/html2canvas.js"
  ></script>

<script>
$(document).ready(() => {
  $('#month-table').DataTable();
});

function CreatePDFfromHTML(id) {
  const HTML_Width = $(`#${id}`).width();
  const HTML_Height = $(`#${id}`).height();
  const top_left_margin = 15;
  const PDF_Width = HTML_Width + top_left_margin * 2;
  const PDF_Height = PDF_Width * 1.5 + top_left_margin * 2;
  const canvas_image_width = HTML_Width;
  const canvas_image_height = HTML_Height;
  const totalPDFPages = Math.ceil(HTML_Height / PDF_Height) - 1;
  html2canvas($(`#${id}`)[0]).then((canvas) => {
      const imgData = canvas.toDataURL('image/jpeg', 1.0);
      const pdf = new jsPDF('p', 'pt', [PDF_Width, PDF_Height]);
      pdf.addImage(
          imgData,
          'JPG',
          top_left_margin,
          top_left_margin,
          canvas_image_width,
          canvas_image_height,
      );
      for (let i = 1; i <= totalPDFPages; i++) {
          pdf.addPage(PDF_Width, PDF_Height);
          pdf.addImage(
              imgData,
              'JPG',
              top_left_margin,
              -(PDF_Height * i) + top_left_margin * 4,
              canvas_image_width,
              canvas_image_height,
          );
      }
      pdf.save(
          'sales-report.pdf',
      );
  });
}
</script>
</html>

